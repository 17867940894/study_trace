<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>密码输入页面</title>
    <link rel="stylesheet" href="../css/login.css">
</head>

<body>
<!--输入区-->
<div class="login">
    <!--键盘输入区-->
    <div class="keyboardEntry">
        <!--密码输入框-->
        <div class="passwordInput">
            <span id="inp">请输入密码</span>
        </div>
        <!--密码按钮-->
        <div class="passwordButtons">

            <div>
                <button class="number">1</button>
                <button class="number">2</button>
                <button class="number">3</button>
            </div>

            <div>
                <button class="number">4</button>
                <button class="number">5</button>
                <button class="number">6</button>
            </div>

            <div>
                <button class="number">7</button>
                <button class="number">8</button>
                <button class="number">9</button>
            </div>

            <div>
                <button class="number">*</button>
                <button class="number">0</button>
                <button class="number">#</button>
            </div>

        </div>
    </div>

    <!--功能区-->
    <div class="updatePassword">
        <button id="ok">确认</button>
        <button id="reset">重新输入</button>
        <button id="quit">退卡</button>
    </div>

</div>
</body>
</html>
<script>
    let money = localStorage.getItem('money');
    let password = localStorage.getItem('password');
    if (money === null) {
        location.href = 'index.html';
    }
    if (password === null) {
        location.href = 'index.html';
    }

    onload = function () {
        let inp = document.getElementById("inp");
        let reset = document.getElementById("reset");
        let quit = document.getElementById("quit");
        let ok = document.getElementById("ok");
        let numbers = document.getElementsByClassName("number");
        let checkoutString = '';
        let correctPassword = localStorage.getItem('password');
        let isOk = false;

        for (let i = 0; i < numbers.length; i++) {
            numbers[i].onclick = function () {
                checkoutString += this.innerText;
                judge();
            }
        }

        reset.onclick = function () {
            checkoutString = '';
            inp.innerText = '请输入密码';
        }

        quit.onclick = function () {
            location.href = 'index.html';
        }

        ok.onclick = function () {
            isOk = true;
            if (checkoutString === '') {
                isOk = false;
                alert('请输入密码');
            } else
                judge();
        }

        //判断 在每一次输入后密码是否正确，输入到达六位数直接进行判断
        function judge() {
            if (checkoutString.length >= 6 || isOk) {
                isOk = false;
                if (checkoutString === correctPassword) {
                    checkoutString = '';
                    inp.innerText = '请输入密码';
                    location.href = "userIndex.html";
                } else {
                    alert('密码错误');
                    checkoutString = '';
                    inp.innerText = '请输入密码';
                }
            } else {
                s = inp.innerText;
                if (s !== '请输入密码')
                    inp.innerText = s + '*';
                else
                    inp.innerText = '*';
            }
        }


    }
</script>